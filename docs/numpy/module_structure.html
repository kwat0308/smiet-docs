


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="numpy_index.html">
      
      
        <link rel="next" href="package_documentation.html">
      
      
      <link rel="icon" href="">
    
    
      
        <title>Module structure - SMIET 0.7 documentation</title>
      
    
    
      
        
      
      


    
    
      
    
    
      
        
        
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
        <link rel="stylesheet" type="text/css" href="../_static/sphinx_immaterial_theme.acf80fe7f4d9ef9e2.min.css?v=9e56d0d2" />
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reading-in-coreas-simulations" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../index.html" title="SMIET 0.7 documentation" class="md-header__button md-logo" aria-label="SMIET 0.7 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>
    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SMIET 0.7 documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Module structure
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="light-green" data-md-color-accent="light-blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="deep-orange" data-md-color-accent="lime"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../index.html" title="SMIET 0.7 documentation" class="md-nav__button md-logo" aria-label="SMIET 0.7 documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>
    </a>
    SMIET 0.7 documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" checked>
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    <span>Sections in this documentation:<wbr></span>
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            <span>Sections in this documentation:<wbr></span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../logging.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>How to use logging in this package</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../conventions_units.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>Conventions in this package</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../minimal_example.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>Minimal Example</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../template-synthesis/ts_index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>A User’s Guide to Template Synthesis</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_5" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="numpy_index.html" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    <span>Num<wbr>Py module</span>
    
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_5" id="__nav_1_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_1_5">
            <span class="md-nav__icon md-icon"></span>
            <span>Num<wbr>Py module</span>
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    <span>Module structure</span>
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="#" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    <span>Module structure</span>
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reading-in-coreas-simulations" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Reading in Co<wbr>REAS simulations</span>
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reading in CoREAS simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coreasshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Coreas<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slicedshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Sliced<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slicedcherenkovshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Sliced<wbr>Cherenkov<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-atmospheric-slice" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>An atmospheric slice</span>
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synthesising-an-entire-shower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Synthesising an entire shower</span>
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synthesising an entire shower">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-template" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Creating a template</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-a-template-to-a-target" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Mapping a template to a target</span>
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="package_documentation.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>Package documentation</span>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../jax/jax_index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>JAX module</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../corsika/corsika_index.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>Tools for CORSIKA/Co<wbr>REAS</span>
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
  
    <li class="md-nav__item">
      <a href="../changelog.html" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    <span>Release notes</span>
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#reading-in-coreas-simulations" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Reading in Co<wbr>REAS simulations</span>
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Reading in CoREAS simulations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#coreasshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Coreas<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slicedshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Sliced<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#slicedcherenkovshower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Sliced<wbr>Cherenkov<wbr>Shower</span>
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#an-atmospheric-slice" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>An atmospheric slice</span>
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#synthesising-an-entire-shower" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Synthesising an entire shower</span>
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Synthesising an entire shower">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-a-template" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Creating a template</span>
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mapping-a-template-to-a-target" class="md-nav__link">
    
    <span class="md-ellipsis">
      <span>Mapping a template to a target</span>
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset" role="main">
                
                
                  


<h1 id="module-structure">Module structure<a class="headerlink" href="#module-structure" title="Link to this heading">¶</a></h1>
<p>The module contains two classes related to the template synthesis algorithm:
<code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> and <code class="docutils literal notranslate"><span class="pre">SliceSynthesis</span></code>. The latter is not meant to be used directly, but is used
internally by the former. The <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> class is the main class of the module and it the
one which should be used to perform the synthesis.</p>
<p>It also has several classes which make it easy to load in CoREAS simulations stored as <cite>HDF5</cite> files.
These are the <code class="docutils literal notranslate"><span class="pre">SlicedShower</span></code> and the <code class="docutils literal notranslate"><span class="pre">SlicedShowerCherenkov</span></code> classes. They are both subclasses of
the <code class="docutils literal notranslate"><span class="pre">CoreasShower</span></code> class, which itself is a subclass of the <code class="docutils literal notranslate"><span class="pre">Shower</span></code>  and the <code class="docutils literal notranslate"><span class="pre">CoreasHDF5</span></code> classes.
These each implement one of the two core aspects of air shower simulations.</p>
<p>For all the coordinate system transformations and other operations, we rely on the
<a class="reference external" href="https://c-glaser.de/physics/radiotools/">radiotools</a> package.</p>
<div class="admonition versionchanged">
<p class="admonition-title"><span class="versionmodified changed">Changed in version 0.5: </span>Antenna positions are stored in internal coordinate system</p>
<p>Since v0.5 all positions in the Shower (sub)classes are stored in our internal coordinate system.</p>
</div>
<div class="admonition versionadded">
<p class="admonition-title"><span class="versionmodified added">Added in version 0.6: </span>Added CoreasShower class</p>
<p>The <code class="docutils literal notranslate"><span class="pre">CoreasShower</span></code> class was added to more easily integrate CoREAS simulations into analyses
with the SMIET software.</p>
</div>
<h2 id="reading-in-coreas-simulations">Reading in CoREAS simulations<a class="headerlink" href="#reading-in-coreas-simulations" title="Link to this heading">¶</a></h2>
<h3 id="shower">Shower<a class="headerlink" href="#shower" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Shower</span></code> class is supposed to be the most minimal representation of an air shower.
When mapping a template to a target, the latter should be a <code class="docutils literal notranslate"><span class="pre">Shower</span></code> object. All other
shower-related classes (listed hereafter) are subclasses of this class and can thus also
be used as targets for mapping.</p>
<p>An air shower is represented by its core position, the shower geometry, longitudinal profile
and the atmosphere, which is stored as an <code class="docutils literal notranslate"><span class="pre">radiotools.atmosphere.models.Atmosphere</span></code> object.
It can also store a magnetic field, with which it can create a <code class="docutils literal notranslate"><span class="pre">radiotools.coordinates.cstrafo</span></code>
object to transform from one coordinate system to another. When setting the longitudinal profile,
a Gaisser-Hillas profile is automatically fitted to find the shower maximum and other parameters
of the shower profile.</p>
<p>One intersting feature of the <code class="docutils literal notranslate"><span class="pre">Shower</span></code> class is the <code class="docutils literal notranslate"><span class="pre">Shower.copy_settings()</span></code> function. With
this function, you can easily copy over the geometry, core position, atmosphere and magnetic field
from another shower in which you can then store other longitudinal profiles for synthesis.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">Shower</span><span class="p">,</span> <span class="n">SlicedShower</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">SlicedShower</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/simulation/file&quot;</span>
<span class="p">)</span>

<span class="n">target</span> <span class="o">=</span> <span class="n">Shower</span><span class="p">()</span>
<span class="n">target</span><span class="o">.</span><span class="n">copy_settings</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>
<span class="n">target</span><span class="o">.</span><span class="n">long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">.</span><span class="n">long</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># take the grammage values from the origin to be consistent</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># this is the sum of e- and e+ (the longitudinal profile)</span>
<span class="p">)</span> <span class="c1"># Here you can set any longitudinal profile you want, but is has to have shape (slices, 2)</span>
</code></pre></div>
</div>
<h3 id="coreasshower">CoreasShower<a class="headerlink" href="#coreasshower" title="Link to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">CoreasShower</span></code> class is a base class for all CoREAS simulations stored in <cite>HDF5</cite> files. It
is a subclass of <code class="docutils literal notranslate"><span class="pre">CoreasHDF5</span></code> which is a class meant to facilitate the interaction with the
CoREAS <cite>HDF5</cite> files. It uses this functionality to populate the attributes it inherits from the
<code class="docutils literal notranslate"><span class="pre">Shower</span></code> class, to create an object which makes it easier to work with the antenna traces of
the CoREAS simulation. Specifically, it has the ability to return a <code class="docutils literal notranslate"><span class="pre">radiotools.coordinates.cstrafo</span></code>
object based on the shower geometry, which makes it easy to transform the antenna positions to
for example the shower plane.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoreasShower</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">CoreasShower</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/simulation/file&quot;</span>
<span class="p">)</span>

<span class="c1"># Get the coordinate transformation object</span>
<span class="n">transformer</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">get_transformer</span><span class="p">()</span>

<span class="c1"># Transform the antenna positions to the shower plane</span>
<span class="n">ant_positions_showerplane</span> <span class="o">=</span> <span class="n">transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">antenna_array</span><span class="p">[</span><span class="s1">&#39;position&#39;</span><span class="p">])</span>
</code></pre></div>
</div>
<p>This class, as well as those that inherit from it, also create an <code class="docutils literal notranslate"><span class="pre">radiotools.atmosphere.models.Atmosphere</span></code>
object that represents the atmosphere used in the simulation, if possible. To do this, it reads
in the atmospheric model number from the simulation settings. If this number is present in the
<code class="docutils literal notranslate"><span class="pre">radiotools.atmosphere.models.atm_models</span></code> dictionary (i.e. one of the predefined models), then
the <code class="docutils literal notranslate"><span class="pre">Atmosphere</span></code> object is created and stored as the <code class="docutils literal notranslate"><span class="pre">atmosphere</span></code> attribute.</p>
<div class="tip admonition">
<p class="admonition-title">Tip</p>
<p>Another way to create a custom atmosphere object, is to manipulate the <code class="docutils literal notranslate"><span class="pre">radiotools.atmosphere.models.atm_models</span></code>
dictionary. For example, if you used a simulation with custom ATMA, ATMB and ATMC values, you can
add these values to the dictionary with the model number you used in the simulation (this is most
likely 10). If you do this before creating the <code class="docutils literal notranslate"><span class="pre">CoreasShower</span></code> object, the <code class="docutils literal notranslate"><span class="pre">Atmosphere</span></code> object
will be created with the custom values.</p>
</div>
<p>Another option is to pass the a GDAS file to constructor, via the <code class="docutils literal notranslate"><span class="pre">gdas_file</span></code> keyword. This
will always take precedence over the atmospheric model number in the simulation settings. From
the file, the atmospheric model parameters are read as well as the refractive index profile
(this is handled by the <code class="docutils literal notranslate"><span class="pre">radiotools</span></code> package).</p>
<div class="danger admonition">
<p class="admonition-title">Danger</p>
<p>When the model number is not defined in <code class="docutils literal notranslate"><span class="pre">radiotools</span></code> and no GDAS file is provided, the
<code class="docutils literal notranslate"><span class="pre">atmosphere</span></code> attribute will be set to <code class="docutils literal notranslate"><span class="pre">None</span></code>. This will lead to issues when using
this shower as an origin for template synthesis, as the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> class
expects the <code class="docutils literal notranslate"><span class="pre">atmosphere</span></code> attribute to be set.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">CoreasShower</span>

<span class="c1"># Create a CoreasShower object with a GDAS file</span>
<span class="n">origin</span> <span class="o">=</span> <span class="n">CoreasShower</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/simulation/file&quot;</span><span class="p">,</span>
    <span class="n">gdas_file</span><span class="o">=</span><span class="s2">&quot;/path/to/gdas/file&quot;</span>
<span class="p">)</span>

<span class="c1"># Access the atmosphere object</span>
<span class="n">atmosphere</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">atmosphere</span>

<span class="c1"># Print the atmospheric model number</span>
<span class="nb">print</span><span class="p">(</span><span class="n">atmosphere</span><span class="o">.</span><span class="n">model_number</span><span class="p">)</span>
</code></pre></div>
</div>
<h3 id="slicedshower">SlicedShower<a class="headerlink" href="#slicedshower" title="Link to this heading">¶</a></h3>
<p>A sliced CoREAS simulation is one which is set up such that each antenna has its radio signal split
into the contributions coming from different atmospheric slices. The width of these slices should be
a constant (in atmospheric depth) and the number of slices should be the same for each antenna. In
CoREAS v1.4 this behaviour is achieved by adding multiple copies of the same physical antenna on the
ground, but configure each to only accept emission from a certain atmospheric depth range. This is done
using the <cite>slantdepth</cite> keyword. For more information, please refer to the
<a class="reference external" href="https://web.iap.kit.edu/huege/downloads/coreas-manual.pdf">CoREAS documentation</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">SlicedShower</span></code> class is meant to be used with simulations where each slice is configured with
the same antennas on the ground. This is the standard for template synthesis. When reading in the
CoREAS <cite>HDF5</cite> file, the magnetic field, core, geometry and longitudinal profile are retrieved and stored
as attributes. The antenna names are retrieved and stored in the <code class="docutils literal notranslate"><span class="pre">ant_names</span></code> attribute. Here it is
important to note that the antenna names are assumed to be in the format <code class="docutils literal notranslate"><span class="pre">{name}x{atmospheric_depth}</span></code>.
To find all the unique antenna names, the antenna names are split on the <code class="docutils literal notranslate"><span class="pre">x</span></code> character and the first
element is stored in a set, which is eventually stored as the <code class="docutils literal notranslate"><span class="pre">ant_names</span></code> attribute.</p>
<div class="important tip admonition">
<p class="admonition-title">Important</p>
<p>The antenna names are assumed to be in the format <code class="docutils literal notranslate"><span class="pre">{antenna_name}x{atmospheric_depth}</span></code>. This is
naming scheme is used by the <a class="reference internal" href="../corsika/corsika_index.html"><span class="doc">CORSIKA tools</span></a> in this package.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">SlicedShower</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">SlicedShower</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/simulation/file&quot;</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">origin</span><span class="o">.</span><span class="n">antenna_names</span><span class="p">)</span>
</code></pre></div>
</div>
<p>Apart from the name, the antenna position is also retrieved and stored in the <code class="docutils literal notranslate"><span class="pre">ant_dict</span></code> attribute.
This is done by looping over all unique antenna names and reading the position of the antenna configured
for atmospheric depth 5 g/cm2 (i.e. <code class="docutils literal notranslate"><span class="pre">x5</span></code> is appended to the antenna name to find the entry in the <cite>HDF5</cite>
file).</p>
<p>The number of slices present in a <code class="docutils literal notranslate"><span class="pre">SlicedShower</span></code> is then calculated as the number of observers in
the <cite>HDF5</cite> file divided by the number of unique antenna names. This is stored in the <code class="docutils literal notranslate"><span class="pre">nr_slices</span></code>
attribute.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">SlicedShower</span>

<span class="n">shower</span> <span class="o">=</span> <span class="n">SlicedShower</span><span class="p">(</span>
     <span class="s2">&quot;/path/to/simulation/file&quot;</span>
<span class="p">)</span>

<span class="c1"># Access trace from single slice</span>
<span class="n">my_ant</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shower</span><span class="o">.</span><span class="n">antenna_names</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">my_slice</span> <span class="o">=</span> <span class="mi">500</span>  <span class="c1"># g/cm2</span>
<span class="n">trace_slice</span> <span class="o">=</span> <span class="n">shower</span><span class="o">.</span><span class="n">get_trace_slice</span><span class="p">(</span><span class="s2">&quot;antenna_name&quot;</span><span class="p">,</span> <span class="mi">500</span><span class="p">)</span>

<span class="c1"># Get complete trace for an antenna</span>
<span class="n">trace_all_slices</span> <span class="o">=</span> <span class="n">shower</span><span class="o">.</span><span class="n">get_trace</span><span class="p">(</span><span class="n">my_ant</span><span class="p">)</span>
</code></pre></div>
</div>
<h3 id="slicedcherenkovshower">SlicedCherenkovShower<a class="headerlink" href="#slicedcherenkovshower" title="Link to this heading">¶</a></h3>
<p>It is also possible to set up simulations where each slice has antennas placed at the same
viewing angle in units of local Cherenkov angle. As the Cherenkov angle is dependent on the atmospheric
depth, this implies a different set of antennas for each slice. It can be useful to opt for this
approach when checking the validity of the template synthesis algorithm or to recalculate the spectral
parameters. For these simulations the <code class="docutils literal notranslate"><span class="pre">SlicedShowerCherenkov</span></code> class can be used. It essentially lifts
some of the assumptions made in <code class="docutils literal notranslate"><span class="pre">SlicedShower</span></code> about the naming of the antennas. This does result in
slightly more memory consumption and a longer loading time.</p>
<h2 id="an-atmospheric-slice">An atmospheric slice<a class="headerlink" href="#an-atmospheric-slice" title="Link to this heading">¶</a></h2>
<p>In the NumPy version of the template synthesis package, a single slice of the atmosphere is represented
by a class called <code class="docutils literal notranslate"><span class="pre">SliceSynthesis</span></code>. Its responsibility is to keep track of all the slice specific
variables, such as the atmospheric depth of the slice, the viewing angles of antennas with respect to
this slice and the amplitude/phase spectra of the radio signal in this slice.</p>
<div class="warning admonition">
<p class="admonition-title">Warning</p>
<p>While it can be very useful to interact with the <code class="docutils literal notranslate"><span class="pre">SliceSynthesis</span></code> class directly for debugging,
we advise against relying on it for scripting purposes. It does not exist in the JAX implementation,
which makes scripts who rely on this class not easily portable. Instead, we recommend using the
convenience functions provided by the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> class to retrieve slice specific
variables.</p>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">SliceSynthesis</span></code> class stores all its variables in a structured NumPy array, which can be accessed
through its <code class="docutils literal notranslate"><span class="pre">antenna_parameters</span></code> property. Two of the fields in this array are <cite>distance</cite> and <cite>viewing_angle</cite>.
These hold the distance from the slice to each antenna and the viewing angle of each antenna, respectively.
Note that these values are updated during the template generation <strong>and</strong> the mapping process, so be sure
to check which steps have been run before interpreting these values.</p>
<p>The other fields of the array contain the amplitude and phase spectra for the geomagnetic and charge-
excess components of the radio signal. These are normalised with respect to the shower geometry. For
the amplitude this means scaling with distance as well as some other factors. There is also the
normalisation using the spectral parameters, interpolated to the viewing angle of the antenna.</p>
<div class="math notranslate nohighlight">
\[\begin{split}A_{\text{geo}} &amp;= \left( \frac{a_{\text{geo}} \cdot N_{\text{slice}} \cdot \sin(\alpha_{\text{GEO}})}{d_{\text{slice}} \cdot \rho_{\text{slice}}} \right) \cdot \exp\left[b_{\text{geo}}(f - f_0) + c_{\text{geo}}(f - f_0)^2\right] \\
A_{\text{ce}} &amp;=  \left( \frac{a_{\text{ce}} \cdot N_{\text{slice}} \cdot \sin(\theta_C)}{d_{\text{slice}}} \right) \cdot \exp\left[b_{\text{ce}}(f - f_0)\right] \\\end{split}\]</div>
<p>The phases are adapted by adding a linear phase gradient corresponding to the arrival time of the
signal as calculated using the shower geometry. The arrival time is calculated using the distance <span class="math notranslate nohighlight">\(D\)</span>
from the slice to the ground along the shower axis and the distance <span class="math notranslate nohighlight">\(L\)</span> from the slice to antenna,
corrected by the effective refractive index <span class="math notranslate nohighlight">\(n_{eff}\)</span>.</p>
<div class="math notranslate nohighlight">
\[\begin{split}t_{obs} &amp;= \frac{ L \times n_{eff} - D }{ c } \\
\phi &amp;= \phi + 2 \pi f t_{obs}\end{split}\]</div>
<p>Here <span class="math notranslate nohighlight">\(c\)</span> is the speed of light in vacuum. During the template generation this correction
essentially moves the peak of the pulse to the very first time bin. Then, when mapping to a target,
the peak is moved back to expected time bin based on its geometry.</p>
<h2 id="synthesising-an-entire-shower">Synthesising an entire shower<a class="headerlink" href="#synthesising-an-entire-shower" title="Link to this heading">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> class stores all the slices of the origin shower, each represented by a
<code class="docutils literal notranslate"><span class="pre">SliceSynthesis</span></code> object, in a list. Furthermore, it acts a central location for all the information
that is shared between the slices, such as the atmospheric model, the shower geometry, the antenna
positions, the valid frequencies and the spectral parameters which are currently loaded.
When creating a template (or loading one from disk) all these attributes are linked to the slices
in the list.</p>
<div class="attention warning admonition">
<p class="admonition-title">Attention</p>
<p>As Python does not really have the concept of pointers, the attributes of the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code>
object do <strong>not</strong> serve as the source of truth for the shared variables. This is to say, if you
update for example the atmosphere of the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> object, the slices will not
automatically receive this update. They will still hold references to the original atmosphere.</p>
</div>
<h3 id="creating-a-template">Creating a template<a class="headerlink" href="#creating-a-template" title="Link to this heading">¶</a></h3>
<p>An origin <code class="docutils literal notranslate"><span class="pre">SlicedShower</span></code> can be processed into a template using the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis.make_template()</span></code>
method. This can take up to a few minutes, depending on the number of slices and the number of antennas in
the shower. This is why we recommend to save the template to disk after it has been created, so that it can
be reused later without having to recompute it. This can be achieved using the
<code class="docutils literal notranslate"><span class="pre">TemplateSynthesis.save_template()</span></code> method. Later on, a <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis</span></code> object can load the template
using the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis.load_template()</span></code> method.</p>
<div class="important tip admonition">
<p class="admonition-title">Important</p>
<p>When saving a template, only some components of the atmosphere are saved. As a result, a GDAS
atmosphere can currently not be stored. When loading a template which was generated with a
GDAS atmosphere, you need to provide the GDAS file again. This is done by passing the <code class="docutils literal notranslate"><span class="pre">gdas_file</span></code>
keyword to the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis.load_template()</span></code> method.</p>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TemplateSynthesis</span><span class="p">,</span> <span class="n">SlicedShower</span>

<span class="n">origin</span> <span class="o">=</span> <span class="n">SlicedShower</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/simulation/file&quot;</span><span class="p">,</span>
    <span class="n">gdas_file</span><span class="o">=</span><span class="s2">&quot;/path/to/gdas/file&quot;</span>  <span class="c1"># Optional, if you want to use a GDAS atmosphere</span>
<span class="p">)</span>

<span class="n">synthesis</span> <span class="o">=</span> <span class="n">TemplateSynthesis</span><span class="p">(</span><span class="n">freq_ar</span><span class="o">=</span><span class="p">[</span><span class="mi">30</span><span class="p">,</span> <span class="mi">500</span><span class="p">,</span> <span class="mi">100</span><span class="p">])</span>
<span class="n">synthesis</span><span class="o">.</span><span class="n">make_template</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>

<span class="c1"># Save the template to disk</span>
<span class="n">synthesis</span><span class="o">.</span><span class="n">save_template</span><span class="p">(</span><span class="n">save_dir</span><span class="o">=</span><span class="s2">&quot;/path/to/save/directory&quot;</span><span class="p">)</span>
</code></pre></div>
</div>
<h3 id="mapping-a-template-to-a-target">Mapping a template to a target<a class="headerlink" href="#mapping-a-template-to-a-target" title="Link to this heading">¶</a></h3>
<p>Once a template has been created, it can be mapped to a target shower using the <code class="docutils literal notranslate"><span class="pre">TemplateSynthesis.map_template()</span></code>
method. This method will take the template and map it onto a target <code class="docutils literal notranslate"><span class="pre">Shower</span></code> object. The target shower should
therefore at least have the core position, shower geometry, atmosphere and magnetic field set, as well as a
longitudinal profile.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">smiet.numpy</span><span class="w"> </span><span class="kn">import</span> <span class="n">TemplateSynthesis</span><span class="p">,</span> <span class="n">Shower</span><span class="p">,</span> <span class="n">geo_ce_to_e</span>
<span class="c1"># Load the template from disk</span>
<span class="n">synthesis</span> <span class="o">=</span> <span class="n">TemplateSynthesis</span><span class="o">.</span><span class="n">load_template</span><span class="p">(</span>
    <span class="s2">&quot;/path/to/template/file.npz&quot;</span>
    <span class="n">gdas_file</span><span class="o">=</span><span class="s2">&quot;/path/to/gdas/file&quot;</span>  <span class="c1"># If the template was created with a GDAS atmosphere, you need to load it again here</span>
<span class="p">)</span>

<span class="c1"># Create a target shower</span>
<span class="n">target</span> <span class="o">=</span> <span class="n">Shower</span><span class="p">()</span>
<span class="n">target</span><span class="o">.</span><span class="n">copy_settings</span><span class="p">(</span><span class="n">origin</span><span class="p">)</span>  <span class="c1"># Copy geometry etc. from the origin shower</span>

<span class="c1"># Set a custom longitudinal profile</span>
<span class="n">target</span><span class="o">.</span><span class="n">long</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">(</span>
    <span class="n">origin</span><span class="o">.</span><span class="n">long</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>  <span class="c1"># take the grammage values from the origin to be consistent</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>  <span class="c1"># this is the sum of e- and e+ (the longitudinal profile)</span>
<span class="p">)</span>

<span class="c1"># Map the template to the target shower</span>
<span class="n">geo</span><span class="p">,</span> <span class="n">ce</span> <span class="o">=</span> <span class="n">synthesis</span><span class="o">.</span><span class="n">map_template</span><span class="p">(</span><span class="n">target</span><span class="p">)</span>

<span class="c1"># Transform geo and ce back to 3D electric field</span>
<span class="n">e_field</span> <span class="o">=</span> <span class="n">geo_ce_to_e</span><span class="p">(</span><span class="n">geo</span><span class="p">,</span> <span class="n">ce</span><span class="p">,</span> <span class="o">*</span><span class="n">synthesis</span><span class="o">.</span><span class="n">antenna_information</span><span class="p">[</span><span class="s2">&quot;position_showerplane&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</code></pre></div>
</div>







  
  






                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  
  
  <div class="md-footer-meta md-typeset">
    
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-footer-copyright__highlight">
        &#169; Copyright 2025, Mitja Desmet, Keito Watanabe.
        
    </div>
  
    Created using
    <a href="https://www.sphinx-doc.org/" target="_blank" rel="noopener">Sphinx</a>
    8.2.3.
     and
    <a href="https://github.com/jbms/sphinx-immaterial/" target="_blank" rel="noopener">Sphinx-Immaterial</a>
  
</div>
      
    </div>
    
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
      
        <script src="../_static/sphinx_immaterial_theme.32136f45f91ae6956.min.js?v=a7a9472a"></script>
        <script id="MathJax-script" src="../_static/mathjax/tex-mml-chtml.js?v=cadf963e"></script>
    
  </body>
</html>